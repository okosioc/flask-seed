function install_form(){$(".form-editor").each(function(e,a){_install_form($(a))}),$(".form-query").each(function(e,a){_install_components($(a))})}function process_form(e){var a={valid:!0},t=e.find("> fieldset, > .card > div > fieldset");return _process(a,t,t.attr("name")),debug(a),a}function _install_form(e){_install_components(e)}function array_action_add(e){var a=e.closest("fieldset.array").find(".array-item.template"),t=a.clone(!0);t.removeClass("template"),t.insertBefore(a),a.next(".array-item").hide(),_install_components(t)}function array_action_delete(e){var a="确定删除此"+e.attr("data-title")+"么?";if(!window.confirm(a))return!1;var t=e.closest("fieldset.array").find(".array-item.template");1==t.prevAll(".array-item").length&&t.next(".array-item").show(),e.closest(".array-item").remove()}function array_action_show_modal(e){var a=e.closest(".array-item").prevAll(".array-item").length,t=e.closest("fieldset.array").find(".modals > .modal"),i=$(t.get(a));i.attr("id")||i.attr("id","modal-"+my_random()),i.modal("show")}function array_action_add_modal(e){var a=e.closest("fieldset.array").find(".modals > .modal.template"),t=a.clone(!0);t.removeClass("template").addClass("adding"),t.insertBefore(a),t.attr("id","modal-"+my_random()),_install_components(t),t.modal("show")}function array_action_cancel_modal(e){var a=e.closest(".modal");a.modal("hide"),a.is(".adding")&&a.remove()}function array_action_save_modal(e){var a=e.closest(".modal"),t={valid:!0},i=a.find(".modal-body > fieldset"),r=i.attr("name");if(_process(t,i,r),debug(t),!t.valid)return showError("检测到不正确的数据, 请更正后重试!"),!1;var n={};$.each(t,function(e,a){n[e.replace(r+".","")]=a}),debug(n);var l,s,d,o=e.closest("fieldset.array").find(".array-item[name]");a.is(".adding")?((s=(l=o.last()).clone(!0)).removeClass("template"),s.insertBefore(l),render_template_using_object(s,n),s.show(),l.next(".array-item").hide(),a.removeClass("adding")):(d=a.prevAll(".modal").length,render_template_using_object($(o.get(d)),n)),a.modal("hide")}function array_action_delete_modal(e){var a="确定删除此"+e.attr("data-title")+"么?";if(!window.confirm(a))return!1;var t=e.closest("fieldset.array").find(".array-item[name]");2==t.length&&t.last().next(".array-item").show();var i=e.closest(".array-item"),r=i.prevAll(".array-item").length,n=e.closest("fieldset.array").find(".modals > .modal");i.remove(),$(n.get(r)).remove()}var relation_action_search_records={};function relation_action_show_search_modal(e){$(".searching").removeClass("searching"),e.addClass("searching"),$("#search-"+e.attr("relation-key")).modal("show")}function relation_action_search(a,e){var t,i,r,n,l,s;a.is(".doing")||(i=(t=a.closest(".modal")).attr("relation-url"),r=t.attr("relation-key"),n={p:e},t.find(".form-search :input[name]").each(function(){n[$(this).attr("name")]=$(this).val()}),a.addClass("doing"),l=a.is("input")?"val":"text",s=a[l](),a[l](s+"..."),$.post(i,n,function(e){0==e.error?relation_action_render_results(r,e[r],e.pagination):showError(e.message),a.removeClass("doing"),a[l](s)},"json"))}function relation_action_render_results(i,e,t){var a=$("#search-"+i.replace(/_/g,"-")),i=a.attr("relation-key"),r=a.attr("relation-id"),n=a.find("table"),l=n.find("tbody > tr[name]").last();l.prevAll("tr").remove(),relation_action_search_records[i]=e,$.each(e,function(e,a){var t=l.clone(!0);t.removeClass("template"),t.insertBefore(l),render_template_using_object(t,a,i,r),t.show()}),e.length?l.next("tr").hide():l.next("tr").show();var t=t,s=n.next(".pagination");s.html(""),1<t.pages?(t.prev&&s.append('<li class="page-item"><a class="page-link" href="javascript:;" onclick="relation_action_search($(this), '+t.prev+')"><</a></li>'),$.each(t.iter_pages,function(e,a){a&&a==t.page?s.append('<li class="page-item active"><a class="page-link" href="javascript:;">'+a+'<span class="sr-only">(current)</span></a></li>'):a?s.append('<li class="page-item"><a class="page-link" href="javascript:;" onclick="relation_action_search($(this), '+a+')">'+a+"</a></li>"):s.append('<li class="page-item"><a class="page-link" href="javascript:;">...</a></li>')}),t.next&&s.append('<li class="page-item"><a class="page-link" href="javascript:;" onclick="relation_action_search($(this), '+t.next+')">></a></li>'),s.show()):s.hide()}function relation_action_search_reset(e){e.closest(".form-search").find(":input[name]").val("")}function relation_action_checkbox_changed(e){var a,t=e.closest("table").find("tbody > tr[name]").not(".template").find(".list-checkbox");e.is(".list-checkbox-all")?(a=e.is(":checked"),t.prop("checked",a)):a=e.is(":checked");var i=t.filter(":checked").length;e.closest(".modal-content").find(".modal-footer .span-checked").text(i)}function relation_action_choosed_return(e){var a=e.closest(".modal"),r=a.attr("relation-key"),t=a.attr("relation-title"),n=a.attr("relation-id"),i=e.closest(".modal-content").find(".modal-body table").find("tbody > tr[name]").not(".template").find(".list-checkbox:checked");if(0==i.length)return showError(e.attr("message")),!1;var l=$.map(i,function(e){return $(e).attr("id").replace(r+"-","")}),s=relation_action_search_records[r].filter(function(e){return l.includes(String(e[n]))}),d=$(".searching"),o=d.closest("fieldset.relation"),c=d.attr("relation-return");if("one"==c&&1<s.length)return showError("只能选择一个"+d.attr("data-title")+"!"),!1;var p,m,u,f=o.find(".form-group > .relation-input-group"),h=o.find(".array-item[name]");f.length?(p=f.children(".badge"),"one"==c&&p.remove(),$.each(s,function(e,a){f.append('<span class="font-size-base badge badge-soft-secondary mr-2" data-id="'+a[n]+'">'+a[t]+'<small class="fe fe-x ml-2" style="cursor:pointer" onclick="$(this).parent().remove();"></small></span>')})):h.length&&(m=h.last(),u=o.find(".modals > .modal").last(),$.each(s,function(e,a){var t=m.clone(!0);t.removeClass("template"),t.insertBefore(m),render_template_using_object(t,a,r,n),t.show(),m.next(".array-item").hide();var i=u.clone(!0);i.removeClass("template show"),i.insertBefore(u),render_template_using_object(i,a,r,n),i.attr("id","modal-"+my_random())})),e.closest(".search-modal").modal("hide")}function render_template_using_object(e,c,a,t){e.find("[name]").each(function(e,a){var s=$(a);if(s.is("fieldset")||s.is(".form-group"))return!0;var t,i=s.attr("name"),d=s.attr("format"),o=s.attr("enum"),r=c[i];function n(e){if(o)e=e&&global_enums[o][e];else if(["checkbox","switch"].includes(d))e="true"==e?"是":"否";else if("datetime"==d)e=e&&e.substr(0,19);else if(["text","int","float"].includes(d)){var a,t;if(0<(n=s.children()).length)return(n=n.clone(!0)).is(".avatar")?(a=n.find(".avatar-title"),e?a.text(e[0]):a.text("")):n.is(".progress")?(t=n.find(".progress-bar"),e?t.css("width",e+"%").attr("aria-valuenow",e):t.css("width","0%").attr("aria-valuenow","0")):n.text("UNSUPPORTED!"),n}else{if(["avatar","image"].includes(d)){var i=(n=s.children().clone(!0)).find("img"),r=i.next("span[fallback]");return e?(i.removeClass("d-none").attr("src",e),r.addClass("d-none").text("")):(i.addClass("d-none").attr("src",""),r.removeClass("d-none").text(c[r.attr("fallback")][0])),n}if("link"==d){var n,l=(n=s.children().clone(!0)).find("a");return e?l.attr("href",e):l.attr("href","javascript:;"),n}}return e||"-"}Array.isArray(r)?r.length?"object"==typeof r[0]&&null!==r[0]?s.html(r.length):s.html(r.map(n).join(" ")):s.html("-"):"object"==typeof r&&null!==r?(t=null,$.each(r,function(e,a){if(a.match(/title|name|\w+name/i))return t=a,!1}),t?(r=r[t],s.html(r||"-")):s.html("-")):s.is(":input")?s.val(n(r)):s.html(n(r))});var i=e.find(".list-checkbox");t&&i.length&&(i.attr("id",a+"-"+c[t]),i.next("label").attr("for",a+"-"+c[t]))}function relation_action_search_reset(e){e.closest(".form-search").find(":input[name]").val("")}function external_link_open(e){var a=e.closest(".input-group").find("input[name]").val().trim();a.length&&(a.startsWith("http://")||a.startsWith("https://")?window.open(a):showWarning("Please input a valid link!"))}function _install_components(e){e.find(".form-group").each(function(e,a){var t=$(a);return!t.closest(".array-item").is(".template")&&(!t.closest(".modal").is(".template")&&(t.find("img[data-src]").each(function(e,a){var t,i=$(a).closest(".plupload-input-group").children(".plupload");i&&(t=i.attr("data-preview")?JSON.parse(i.attr("data-preview")):{},$(a).attr("src",my_preview($(a).data("src"),t)))}),t.find(".custom-switch").each(function(e,a){var t="switch-"+my_random(),i=$(a).find(":checkbox");i.attr("id",t),i.next("label").attr("for",t)}),t.find("input.date-time").each(function(e,a){$(a).flatpickr({locale:"zh",allowInput:!0,enableTime:!0,dateFormat:"Y-m-d H:i:S",defaultHour:(new Date).getHours(),defaultMinute:(new Date).getMinutes()})}),t.find("input.date").each(function(e,a){$(a).flatpickr({allowInput:!0,locale:"zh",dateFormat:"Y-m-d"})}),t.find(".time-range-input-group").each(function(e,a){var t=$(a).find(".time-start").timepicker({timeFormat:"H:i"}),i=$(a).find(".time-end").timepicker({timeFormat:"H:i"});t.change(function(){var e=$(this).val();if(!my_validateHhMm(e))return!1;var a=e.split(":"),t=(parseInt(a[0])+1).toString().padStart(2,"0");i.val(t+":"+a[1])})}),t.find(".cascader-input-group").each(function(e,a){var s=$(a).find(".cascader"),d=$(a).find(".cascader-list"),t=(t=window[s.attr("data-source")])||[];$.each(t,function(e,a){var t,i=null;a.children&&a.children.length?(i=$('<li class="dropright"><a class="dropdown-item dropdown-toggle" href="javascript:;" data-toggle="dropdown" code="'+a.code+'">'+a.name+"</a></li>"),t=$('<ul class="dropdown-menu"></ul>'),$.each(a.children,function(e,a){t.append($('<li><a class="dropdown-item" href="javascript:;" code="'+a.code+'">'+a.name+"</a></li>"))}),i.append(t)):i=$('<li><a class="dropdown-item" code="'+a.code+'">'+a.name+"</a></li>"),d.append(i)}),d.find("a").click(function(e){e.preventDefault(),e.stopPropagation();var a=$(this),t=a.closest(".dropdown-menu"),i=t.find(".dropdown-menu");$.each(i,function(e,a){$(a).removeClass("show"),$(a).find("a").removeClass("active")}),t.find("> li > a").removeClass("active"),a.addClass("active");var r=[],n=[];a.parentsUntil(".cascader-list").each(function(e,a){var t;$(a).is("li")&&(t=$(a).find("> a"),r.push(t.text()),n.push(t.attr("code")))}),s.val(r.reverse().join("/")),s.attr("data-codes",JSON.stringify(n.reverse()));var l=a.parent(".dropup, .dropright, .dropdown, .dropleft");l.length?l.find(".dropdown-menu").addClass("show"):d.removeClass("show")});var r=s.attr("data-codes")?JSON.parse(s.attr("data-codes")):[],n=[],l=d;$.each(r,function(e,a){var t=l.find("> li:has(a[code='"+r[e]+"'])");if(t.length){var i=t.children("a");if(i.addClass("active"),n.push(i.text()),0===(l=t.children("ul")).length)return!1;l.addClass("show")}}),s.val(n.join("/"))}),t.find(".tag-cloud-input-group").each(function(e,a){function i(t){var e,i;0<(t=$.trim(t)).length&&(e=n.children(".badge"),i=!1,$.each(e,function(e,a){if($.trim($(a).text())==t)return!(i=!0)}),i?showWarning("已经包含该标签!"):n.find(".twitter-typeahead").before('<span class="font-size-base badge badge-soft-secondary mr-2 mb-2">'+t+'<small class="fe fe-x ml-2" style="cursor:pointer" onclick="$(this).parent().remove();"></small></span>'))}var r,n=$(a),t=n.attr("data-tags")?JSON.parse(n.attr("data-tags")):[];n.find(".tag-input").typeahead({hint:!1,highlight:!0,minLength:0},{name:"tags",limit:10,source:(r=t,function(t,e){var i=[];$.each(r,function(e,a){a.includes(t)&&i.push(a)}),e(i)})}).bind("typeahead:select",function(e,a,t){i(a),$(this).typeahead("val","").blur()}).on("keyup",function(e){13==e.which&&(i($(this).val()),$(this).typeahead("val","").blur())})}),t.find(".range-input-group").each(function(e,a){var t=$(a).find(".custom-range"),i=$(a).find(".range-value"),r=i.text(),n=$(a).attr("data-steps")?JSON.parse($(a).attr("data-steps")):{},l=-1;if(Object.keys(n).length)for(var s in l=Object.keys(n).length-1,t.attr("max",l),n)if(String(n[s])==r){t.val(parseInt(s));break}t.on("input",function(){var e=String($(this).val()),a=e;-1!=l&&(a=n[e]),i.text(a)})}),t.find("select.select2").each(function(e,a){var t=a.getAttribute("data-onchange"),i={containerCssClass:a.getAttribute("class").replace("select2",""),dropdownCssClass:a.classList.contains("custom-select-sm")||a.classList.contains("form-control-sm")?"dropdown-menu dropdown-menu-sm show":"dropdown-menu show",dropdownParent:a.closest(".modal-body")||document.body,tags:$(a).is("[tags]")};$(a).select2(i).on("select2:select",function(e){t&&window[t](e,a)})}),t.find(".plupload").each(function(e,a){install_plupload($(a))}),t.find(".quill").each(function(e,a){install_quill($(a))}),void t.find(".autosize").each(function(e,a){autosize(a)})))})}var global_pluploading=!1;function install_plupload(e){var i=e.closest(".plupload-input-group").find(".plupload-input-result"),r=e.is("[multiple]"),o=e.data("hiddens"),a=e.data("upload"),t=e.data("token"),n=e.data("max"),c=e.attr("data-preview")?JSON.parse(e.attr("data-preview")):{},p=e.attr("data-suffix")?JSON.parse(e.attr("data-suffix")):{},l=e.attr("data-filters")?JSON.parse(e.attr("data-filters")):{},m=i.is(".image-input-result");e.attr("id","plupload-"+my_random());var s=new plupload.Uploader({browse_button:e[0],url:a,max_file_size:n,filters:l,multi_selection:r,multipart_params:{token:t}});s.init(),s.bind("FilesAdded",function(e,a){var t="";plupload.each(a,function(e){t+=m?'<div id="'+e.id+'" class="image uploading"><div class="progress progress-sm"><div class="progress-bar" style="width:5%;"></div></div></div>':'<div id="'+e.id+'" class="file uploading d-flex justify-content-start align-items-center"><div class="mr-3">'+e.name+'</div><div class="flex-grow-1 mr-3"><div class="progress progress-sm"><div class="progress-bar" style="width:5%;"></div></div></div></div>'}),r?i.append(t):i.html(t),e.start(),global_pluploading=!0}),s.bind("UploadProgress",function(e,a){$("#"+a.id).find(".progress-bar").css("width",a.percent+"%")}),s.bind("Error",function(e,a){var t;a.file&&$("#"+a.file.id).length?(t='<small class="text-danger">'+a.file.name+(m?"<br>":"")+a.message+" ("+a.code+")</small>",$("#"+a.file.id).removeClass("uploading").addClass("error").html(t)):showError("Failed when uploading, "+a.message+" ("+a.code+")")}),s.bind("FileUploaded",function(e,a,t){var i,r,n,l,s,d=jQuery.parseJSON(t.response);d.error?(i='<small class="text-danger">'+a.name+(m?"<br>":" ")+d.error+"</small>",$("#"+a.id).removeClass("uploading").addClass("error").html(i)):((r=$("#"+a.id)).removeClass("uploading").addClass("uploaded"),s=m?(n=my_preview(d.url,c),l=$("<img>").one("load",function(){$(this).closest(".image").css("width","auto")}).attr("src",n),r.html(l),'<div class="btns"><a href="'+d.url+'" target="_blank">i</a><a href="javascript:;" onclick="$(this).closest(\'.image\').remove();">x</a></div>'):(r.find(".flex-grow-1").remove(),'<div><a class="mr-2" href="'+d.url+'" target="_blank">i</a><a href="javascript:;" onclick="$(this).closest(\'.file\').remove();">x</a></div>'),r.append(s),$.each(o.split(","),function(e,a){var t=a in d?d[a]:"";"url"==a&&(t=my_preview(t,p));var i=$('<input type="hidden" name="'+a+'">').val(t);r.append(i)}))}),s.bind("UploadComplete",function(e,a){global_pluploading=!1})}function install_quill(e){var a=my_random(),t=e.data("upload"),i=e.data("token"),r=e.data("max"),n=e.attr("data-preview")?JSON.parse(e.attr("data-preview")):{},l=e.attr("data-filters")?JSON.parse(e.attr("data-filters")):{};e.attr("id","quill-"+a);var s=new Quill(e[0],{placeholder:"Please input rich text here",theme:"snow",modules:{toolbar:{container:[[{header:[2,!1]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],["link","image"],["blockquote","code-block"],["clean"]],handlers:{image:function(e){e?$("#quill-plupload-"+a).next(".moxie-shim").children("input[type=file]").trigger("click"):this.quill.format("image",!1)}}}}}),d=e.closest(".rte-input-group").find(".quill-plupload");d.attr("id","quill-plupload-"+a);var o=new plupload.Uploader({browse_button:d[0],url:t,max_file_size:r,filters:l,multi_selection:!0,multipart_params:{token:i}});o.init(),o.bind("FilesAdded",function(e,a){e.start(),global_pluploading=!0}),o.bind("Error",function(e,a){a.file?showError("Failed when uploading file "+a.file.name+", "+a.message+" ("+a.code+")"):showError("Failed when uploading, "+a.message+" ("+a.code+")")}),o.bind("FileUploaded",function(e,a,t){var i,r=jQuery.parseJSON(t.response);r.error?showError("Failed when uploading file "+a.name+", "+r.error):(i=(s.getSelection()||{}).index||s.getLength(),s.insertEmbed(i,"image",my_preview(r.url,n)),s.insertText(i+1,"\n"),s.setSelection(i+2))}),o.bind("UploadComplete",function(e,a){global_pluploading=!1})}function _process(r,e,n){var a,t,i,l,s,d,o,c,p,m,u,f,h,v,g,_,w,b,y,C,x,k,j,q,S,O,N,J,E,F,P,A,U;debug("Try to process path "+n+" with "+e.attr("class")),e.is(".object")||e.is(".group")?((a=e.children(".card")).length&&(e=a.children("div")),e.find("> .form-group, > .form-row .form-group, > .row  > div > .form-group, > .row  > div > .row  > div > .form-group, > .row  > div > .card > div > .row  > div > .form-group, > fieldset, > .row  > div > fieldset, > .row  > div > .card > div > fieldset, > .row  > div > .card > div > .row  > div > fieldset").each(function(e,a){var t;$(a).is("fieldset.group")?_process(r,$(a),n):(t=$(a).attr("name"))&&(t.includes(".")?_process(r,$(a),t):_process(r,$(a),n+"."+t))})):e.is(".array")?(t=e.find(".modals"),i=e.find(".array-item[name]"),l=e.find("select"),h=e.find(".plupload-input-group"),s=e.find(".tag-cloud-input-group, .relation-input-group"),d=e.find(".cascader-input-group"),t.length?t.find("> .modal").not(".template").each(function(e,a){var t=$(a).find(".modal-body > fieldset");_process(r,t,n+"["+e+"]")}):i.length?i.not(".template").each(function(t,e){var a,i;$(e).is("tr")?$(e).find("> td[name]").each(function(e,a){_process(r,$(a),n+"["+t+"]."+$(a).attr("name"))}):(a=$(e).find("fieldset[name]")).length?_process(r,a,n+"["+t+"]"):(i=$(e).find(".form-group[name]")).length&&_process(r,i,n+"["+t+"]")}):l.length?(l.removeClass("is-valid is-invalid"),(o=l.val()).length?e.is(".relation")?(P=e.children(".form-group").attr("relation-id"),A=e.children(".form-group").attr("relation-title"),$.each(o,function(e,a){r[n+"["+e+"]."+P]=a,r[n+"["+e+"]."+A]=l.children("option[value="+a+"]").text()})):$.each(o,function(e,a){r[n+"["+e+"]"]=a}):l.is("[required]")&&(l.addClass("is-invalid"),r.valid=!1),debug("Parsed array's length is "+o.length)):h.length?(h.removeClass("is-valid is-invalid"),(c=h.find(".uploaded")).length?$.each(c,function(t,e){var a=$(e).find(":hidden[name]");1==a.length?r[n+"["+t+"]"]=a.val():$.each(a,function(e,a){r[n+"["+t+"]."+$(a).attr("name")]=$(a).val()})}):h.is("[required]")&&(h.addClass("is-invalid"),r.valid=!1),debug("Parsed array's length is "+c.length)):s.length?(s.removeClass("is-valid is-invalid"),(p=s.children(".badge")).length?e.is(".relation")?(P=s.parent(".form-group").attr("relation-id"),A=s.parent(".form-group").attr("relation-title"),$.each(p,function(e,a){r[n.replace("@","")+"["+e+"]."+P]=$(a).attr("data-id"),r[n.replace("@","")+"["+e+"]."+A]=$.trim($(a).text())})):$.each(p,function(e,a){r[n+"["+e+"]"]=$.trim($(a).text())}):s.is("[required]")&&(s.addClass("is-invalid"),r.valid=!1),debug("Parsed array's length is "+p.length)):d.length?(d.removeClass("is-valid is-invalid"),(u=(m=d.find(".cascader")).attr("data-codes")?JSON.parse(m.attr("data-codes")):[]).length?$.each(u,function(e,a){r[n+"["+e+"]"]=a}):d.is("[required]")&&(d.addClass("is-invalid"),r.valid=!1),debug("Parsed array's length is "+u.length)):e.children("fieldset").not(".template").each(function(e,a){_process(r,$(a),n+"["+e+"]")})):(f=e.find(".radio-input-group"),h=e.find(".plupload-input-group"),v=e.find(".rte-input-group"),g=e.find(".time-range-input-group"),_=e.find(".range-input-group"),w=e.find(".relation-input-group"),b=e.find(".input-group"),y=e.find("select"),C=e.find(":input[name]"),f.length?(f.removeClass("is-valid is-invalid"),(x=f.find(".active")).length?r[n]=x.children(":radio").val().trim():f.is("[required]")&&(f.addClass("is-invalid"),r.valid=!1)):h.length?(h.removeClass("in-valid is-invalid"),(k=h.find(".uploaded")).length?r[n]=k.find(":hidden[name=url]").val():h.is("[required]")&&(h.addClass("is-invalid"),r.valid=!1)):v.length?(v.removeClass("in-valid is-invalid"),j=v.find(".ql-editor").html().trim(),v.find(".ql-editor").text().trim().length?r[n]=j:v.is("[required]")&&(v.addClass("is-invalid"),r.valid=!1)):g.length?(S=(q=g.find("input.time-start")).val().trim(),N=(O=g.find("input.time-end")).val().trim(),g.removeClass("in-valid is-invalid"),q.removeClass("in-valid is-invalid"),O.removeClass("in-valid is-invalid"),S.length||N.length?(r[n.replace("@",q.attr("name"))]=S,r[n.replace("@",O.attr("name"))]=N,r[n]=S+"~"+N,!my_validateHhMm(S)||!my_validateHhMm(N)||N<=S?(g.addClass("is-invalid"),q.addClass("is-invalid"),O.addClass("is-invalid"),r.valid=!1):(g.addClass("is-valid"),q.addClass("is-valid"),O.addClass("is-valid"))):g.is("[required]")&&(g.addClass("is-invalid"),q.addClass("is-invalid"),O.addClass("is-invalid"),r.valid=!1)):_.length?(_.removeClass("in-valid is-invalid"),(J=_.find(".range-value").text().trim()).length?r[n]=J:_.is("[required]")&&(_.addClass("is-invalid"),r.valid=!1)):w.length?(w.removeClass("is-valid is-invalid"),(E=w.children(".badge")).length?e.is(".relation")?(P=e.attr("relation-id"),A=e.attr("relation-title"),r[n.replace("@",P)]=E.attr("data-id"),r[n.replace("@",A)]=$.trim(E.text())):r[n]=$.trim(E.text()):w.is("[required]")&&(w.addClass("is-invalid"),r.valid=!1)):b.length?(F=b.find(":input[name]"),b.removeClass("is-invalid is-valid"),U=F.val().trim(),F.is(":checkbox")&&(U=F.is(":checked")?"true":"false"),U.length?(r[n]=U,F[0].checkValidity&&(!1===F[0].checkValidity()?(b.addClass("is-invalid"),F.addClass("is-invalid"),r.valid=!1):(b.addClass("is-valid"),F.addClass("is-valid")))):b.is("[required]")&&(b.addClass("is-invalid"),F.addClass("is-invalid"),r.valid=!1)):y.length?(y.removeClass("is-invalid is-valid"),(U=y.val()).length?e.is(".relation")?(P=e.attr("relation-id"),A=e.attr("relation-title"),r[n.replace("@",P)]=U,r[n.replace("@",A)]=y.children("option[value="+U+"]").text()):r[n]=U:y.is("[required]")&&(y.addClass("is-invalid"),r.valid=!1)):C.length&&(C.removeClass("is-invalid is-valid"),U=C.val().trim(),C.is(":checkbox")&&(U=C.is(":checked")?"true":"false"),U.length?(r[n]=U,C[0].checkValidity&&(!1===C[0].checkValidity()?(C.addClass("is-invalid"),r.valid=!1):C.addClass("is-valid"))):C.is("[required]")&&(C.addClass("is-invalid"),r.valid=!1)),debug("Parsed string is "+r[n]),n.includes("@")&&delete r[n])}function debug(e,a){console&&console.log&&(a?console.log(e,a):console.log(e))}function my_preview(e,a){var t=e.split(/[#?]/)[0],i=t.split(".").pop().trim().toLowerCase();return("mov"==i||"mp4"==i||"mpeg"==i||"webm"==i)&&"video"in a?t+a.video:"image"in a?t+a.image:e}function my_random(){return Math.floor(1e9*Math.random())}function my_validateHhMm(e){return/^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/.test(e)}
function install_form(){$(".form-editor").each(function(e,a){_install_form($(a))}),$(".form-query").each(function(e,a){_install_components($(a))})}function process_form(e){var a={valid:!0},t=e.find("> fieldset, > .card > div > fieldset");return _process(a,t,t.attr("name")),debug(a),a}function _install_form(e){e.find(".act > .add").click(function(){var e=$(this).parent().prev(".list-group"),a=e.children(".list-group-item.template").clone(!0);a.removeClass("template"),e.append(a),_install_components(a)}),e.find(".act > .del").click(function(){return!!window.confirm("Are you sure to delete this item?")&&void $(this).closest(".list-group-item").remove()}),e.find(".card-action-add").click(function(){var e=$(this).closest("fieldset.array").find(".cards").find("> .card-wrapper, > div > .card-wrapper").last(),a=e.clone(!0);a.removeClass("template"),a.insertBefore(e),a.show(),_install_components(a)}),e.find(".card-action-delete").click(function(){var e=$(this),a=e.closest("fieldset.array").find(".cards").find(">.card-wrapper, > div > .card-wrapper").length,t=e.attr("data-title");if(2==a)return showError("至少包含一个"+t+"!"),!1;var i="确定删除此"+t+"么?";if(!window.confirm(i))return!1;e.closest(".card-wrapper").remove()}),_install_components(e)}function array_action_add(e){var a=e.closest("fieldset.array").find(".array-item.template"),t=a.clone(!0);t.removeClass("template"),t.insertBefore(a),a.next(".array-item").hide(),_install_components(t)}function array_action_delete(e){var a="确定删除此"+e.attr("data-title")+"么?";if(!window.confirm(a))return!1;var t=e.closest("fieldset.array").find(".array-item.template");2==t.prevAll(".array-item").length&&t.next(".array-item").show(),e.closest(".array-item").remove()}function array_action_show_modal(e){var a=e.closest(".array-item").prevAll(".array-item").length,t=e.closest("fieldset.array").find(".modals > .modal"),i=$(t.get(a));i.attr("id")||i.attr("id","modal-"+my_random()),i.modal("show")}function array_action_add_modal(e){var a=e.closest("fieldset.array").find(".modals > .modal.template"),t=a.clone(!0);t.removeClass("template").addClass("adding"),t.insertBefore(a),t.attr("id","modal-"+my_random()),_install_components(t),t.modal("show")}function array_action_cancel_modal(e){var a=e.closest(".modal");a.modal("hide"),a.is(".adding")&&a.remove()}function array_action_save_modal(e){var a=e.closest(".modal"),t={valid:!0},i=a.find(".modal-body > fieldset"),r=i.attr("name");if(_process(t,i,r),debug(t),!t.valid)return showError("检测到不正确的数据, 请更正后重试!"),!1;var n={};$.each(t,function(e,a){n[e.replace(r+".","")]=a}),debug(n);var l,s,d,o=e.closest("fieldset.array").find(".array-item[name]");a.is(".adding")?((s=(l=o.last()).clone(!0)).removeClass("template"),s.insertBefore(l),render_template_using_object(s,n),s.show(),l.next(".array-item").hide(),a.removeClass("adding")):(d=a.prevAll(".modal").length,render_template_using_object($(o.get(d)),n)),a.modal("hide")}function array_action_delete_modal(e){var a="确定删除此"+e.attr("data-title")+"么?";if(!window.confirm(a))return!1;var t=e.closest("fieldset.array").find(".array-item[name]");2==t.length&&t.last().next(".array-item").show();var i=e.closest(".array-item"),r=i.prevAll(".array-item").length,n=e.closest("fieldset.array").find(".modals > .modal");i.remove(),$(n.get(r)).remove()}var relation_action_search_records={};function relation_action_show_search_modal(e){$(".searching").removeClass("searching"),e.addClass("searching"),$("#search-"+e.attr("relation-key")).modal("show")}function relation_action_search(a,e){var t,i,r,n,l,s;a.is(".doing")||(i=(t=a.closest(".modal")).attr("relation-url"),r=t.attr("relation-key"),n={p:e},t.find(".form-search :input[name]").each(function(){n[$(this).attr("name")]=$(this).val()}),a.addClass("doing"),l=a.is("input")?"val":"text",s=a[l](),a[l](s+"..."),$.post(i,n,function(e){0==e.error?relation_action_render_results(r,e[r],e.pagination):showError(e.message),a.removeClass("doing"),a[l](s)},"json"))}function relation_action_render_results(i,e,t){var a=$("#search-"+i.replace(/_/g,"-")),i=a.attr("relation-key"),r=a.attr("relation-id"),n=a.find("table"),l=n.find("tbody > tr[name]").last();l.prevAll("tr").remove(),relation_action_search_records[i]=e,$.each(e,function(e,a){var t=l.clone(!0);t.removeClass("template"),t.insertBefore(l),render_template_using_object(t,a,i,r),t.show()}),e.length?l.next("tr").hide():l.next("tr").show();var t=t,s=n.next(".pagination");s.html(""),1<t.pages?(t.prev&&s.append('<li class="page-item"><a class="page-link" href="javascript:;" onclick="relation_action_search($(this), '+t.prev+')"><</a></li>'),$.each(t.iter_pages,function(e,a){a&&a==t.page?s.append('<li class="page-item active"><a class="page-link" href="javascript:;">'+a+'<span class="sr-only">(current)</span></a></li>'):a?s.append('<li class="page-item"><a class="page-link" href="javascript:;" onclick="relation_action_search($(this), '+a+')">'+a+"</a></li>"):s.append('<li class="page-item"><a class="page-link" href="javascript:;">...</a></li>')}),t.next&&s.append('<li class="page-item"><a class="page-link" href="javascript:;" onclick="relation_action_search($(this), '+t.next+')">></a></li>'),s.show()):s.hide()}function relation_action_search_reset(e){e.closest(".form-search").find(":input[name]").val("")}function relation_action_checkbox_changed(e){var a,t=e.closest("table").find("tbody > tr[name]").not(".template").find(".list-checkbox");e.is(".list-checkbox-all")?(a=e.is(":checked"),t.prop("checked",a)):a=e.is(":checked");var i=t.filter(":checked").length;e.closest(".modal-content").find(".modal-footer .span-checked").text(i)}function relation_action_choosed_return(e){var a=e.closest(".modal"),r=a.attr("relation-key"),t=a.attr("relation-title"),n=a.attr("relation-id"),i=e.closest(".modal-content").find(".modal-body table").find("tbody > tr[name]").not(".template").find(".list-checkbox:checked");if(0==i.length)return showError(e.attr("message")),!1;var l=$.map(i,function(e){return $(e).attr("id").replace(r+"-","")}),s=relation_action_search_records[r].filter(function(e){return l.includes(String(e[n]))}),d=$(".searching"),o=d.closest("fieldset.relation"),c=d.attr("relation-return");if("one"==c&&1<s.length)return showError("只能选择一个"+d.attr("data-title")+"!"),!1;var m,p,f,u=o.find(".form-group > .relation-input-group"),h=o.find(".array-item[name]");u.length?(m=u.children(".badge"),"one"==c&&m.remove(),$.each(s,function(e,a){u.append('<span class="font-size-base badge badge-soft-secondary mr-2" data-id="'+a[n]+'">'+a[t]+'<small class="fe fe-x ml-2" style="cursor:pointer" onclick="$(this).parent().remove();"></small></span>')})):h.length&&(p=h.last(),f=o.find(".modals > .modal").last(),$.each(s,function(e,a){var t=p.clone(!0);t.removeClass("template"),t.insertBefore(p),render_template_using_object(t,a,r,n),t.show(),p.next(".array-item").hide();var i=f.clone(!0);i.removeClass("template show"),i.insertBefore(f),render_template_using_object(i,a,r,n),i.attr("id","modal-"+my_random())})),e.closest(".search-modal").modal("hide")}function render_template_using_object(e,c,a,t){e.find("[name]").each(function(e,a){var s=$(a);if(s.is("fieldset")||s.is(".form-group"))return!0;var t,i=s.attr("name"),d=s.attr("format"),o=s.attr("enum"),r=c[i];function n(e){if(o)e=e&&global_enums[o][e];else if(["checkbox","switch"].includes(d))e="true"==e?"是":"否";else if("datetime"==d)e=e&&e.substr(0,19);else if(["text","int","float"].includes(d)){var a,t;if(0<(n=s.children()).length)return(n=n.clone(!0)).is(".avatar")?(a=n.find(".avatar-title"),e?a.text(e[0]):a.text("")):n.is(".progress")?(t=n.find(".progress-bar"),e?t.css("width",e+"%").attr("aria-valuenow",e):t.css("width","0%").attr("aria-valuenow","0")):n.text("UNSUPPORTED!"),n}else{if(["avatar","image"].includes(d)){var i=(n=s.children().clone(!0)).find("img"),r=i.next("span[fallback]");return e?(i.removeClass("d-none").attr("src",e),r.addClass("d-none").text("")):(i.addClass("d-none").attr("src",""),r.removeClass("d-none").text(c[r.attr("fallback")][0])),n}if("link"==d){var n,l=(n=s.children().clone(!0)).find("a");return e?l.attr("href",e):l.attr("href","javascript:;"),n}}return e||"-"}Array.isArray(r)?r.length?"object"==typeof r[0]&&null!==r[0]?s.html(r.length):s.html(r.map(n).join(" ")):s.html("-"):"object"==typeof r&&null!==r?(t=null,$.each(r,function(e,a){if(a.match(/title|name|\w+name/i))return t=a,!1}),t?(r=r[t],s.html(r||"-")):s.html("-")):s.is(":input")?s.val(n(r)):s.html(n(r))});var i=e.find(".list-checkbox");t&&i.length&&(i.attr("id",a+"-"+c[t]),i.next("label").attr("for",a+"-"+c[t]))}function relation_action_search_reset(e){e.closest(".form-search").find(":input[name]").val("")}function list_action_add(e){var a=e.closest("fieldset").find(".list-group > .list-group-item[name]").last(),t=a.clone(!0);t.removeClass("template"),t.insertBefore(a),a.next(".list-group-item").hide(),_install_components(t)}function list_action_delete(e){var a="确定删除此"+e.attr("data-title")+"么?";if(!window.confirm(a))return!1;var t=e.closest("fieldset").find(".list-group > .list-group-item[name]");2==t.length&&t.last().next(".list-group-item").show(),e.closest(".list-group-item").remove()}function table_action_add(e){var a=e.closest("fieldset").find("table > tbody > tr[name]").last(),t=a.clone(!0);t.removeClass("template"),t.insertBefore(a),t.show(),a.next("tr").hide()}function table_action_delete(e){var a="确定删除此"+e.attr("data-title")+"么?";if(!window.confirm(a))return!1;var t=e.closest("fieldset").find("table > tbody > tr[name]");2==t.length&&t.last().next("tr").show(),e.closest("tr").remove()}function modal_action_toggle(e){var a=e.closest("tr").prevAll("tr").length,t=e.closest("fieldset").find(".modals > .modal"),i=$(t.get(a));i.attr("id")||i.attr("id","modal-"+my_random()),i.modal("show")}function modal_action_save(e){var a=e.closest(".modal"),l={valid:!0},s=a.find(".modal-body > fieldset");if(_process(l,s,s.attr("name")),debug(l),!l.valid)return showError("检测到不正确的数据, 请更正后重试!"),!1;e.closest("fieldset").find(".modals > .modal");var t,i,r,n,d=e.closest("fieldset").find("table > tbody > tr[name]"),o=null;a.is(".template")?((i=(t=d.last()).clone(!0)).removeClass("template"),i.insertBefore(t),i.show(),o=i,t.next("tr").hide(),(r=a.clone(!0)).removeClass("template show"),r.insertBefore(a),r.attr("id","modal-"+my_random()),r.hide()):(n=a.prevAll(".modal").length,o=$(d.get(n))),o.children("td[name]").each(function(e,a){var t=$(a),i=t.attr("name"),r=t.attr("format"),n=l[s.attr("name")+"."+i];"select"==r?n=s.find("select[name='"+i+"'] option:selected").text():"buttongroup"==r?n=s.find(".radio-input-group label.active").text():["checkbox","switch"].includes(r)&&(n="true"==n?"是":"否"),n?t.text(n):t.text("")}),a.modal("hide")}function modal_action_add(e){var a=e.closest("fieldset").find(".modals > .modal").last();a.attr("id")||a.attr("id","modal-"+my_random()),a.modal("show")}function modal_action_delete(e){var a="确定删除此"+e.attr("data-title")+"么?";if(!window.confirm(a))return!1;var t=e.closest("fieldset").find("table > tbody > tr[name]");2==t.length&&t.last().next("tr").show();var i=e.closest("tr"),r=i.prevAll("tr").length,n=e.closest("fieldset").find(".modals > .modal");i.remove(),$(n.get(r)).remove()}function external_link_open(e){var a=e.closest(".input-group").find("input[name]").val().trim();a.length&&(a.startsWith("http://")||a.startsWith("https://")?window.open(a):showWarning("Please input a valid link!"))}function _install_components(e){e.find(".form-group").each(function(e,a){var t=$(a);return!t.closest(".list-group-item").is(".template")&&(!t.closest("fieldset").is(".template")&&(!t.closest(".card-wrapper").is(".template")&&(!t.closest(".modal").is(".template")&&(t.find("img[data-src]").each(function(e,a){var t,i=$(a).closest(".plupload-input-group").children(".plupload");i&&(t=i.attr("data-preview")?JSON.parse(i.attr("data-preview")):{},$(a).attr("src",my_preview($(a).data("src"),t)))}),t.find(".custom-switch").each(function(e,a){var t="switch-"+my_random(),i=$(a).find(":checkbox");i.attr("id",t),i.next("label").attr("for",t)}),t.find("input.date-time").each(function(e,a){$(a).flatpickr({locale:"zh",allowInput:!0,enableTime:!0,dateFormat:"Y-m-d H:i:S",defaultHour:(new Date).getHours(),defaultMinute:(new Date).getMinutes()})}),t.find("input.date").each(function(e,a){$(a).flatpickr({allowInput:!0,locale:"zh",dateFormat:"Y-m-d"})}),t.find(".time-range-input-group").each(function(e,a){var t=$(a).find(".time-start").timepicker({timeFormat:"H:i"}),i=$(a).find(".time-end").timepicker({timeFormat:"H:i"});t.change(function(){var e=$(this).val();if(!my_validateHhMm(e))return!1;var a=e.split(":"),t=(parseInt(a[0])+1).toString().padStart(2,"0");i.val(t+":"+a[1])})}),t.find(".cascader-input-group").each(function(e,a){var s=$(a).find(".cascader"),d=$(a).find(".cascader-list"),t=(t=window[s.attr("data-source")])||[];$.each(t,function(e,a){var t,i=null;a.children&&a.children.length?(i=$('<li class="dropright"><a class="dropdown-item dropdown-toggle" href="javascript:;" data-toggle="dropdown" code="'+a.code+'">'+a.name+"</a></li>"),t=$('<ul class="dropdown-menu"></ul>'),$.each(a.children,function(e,a){t.append($('<li><a class="dropdown-item" href="javascript:;" code="'+a.code+'">'+a.name+"</a></li>"))}),i.append(t)):i=$('<li><a class="dropdown-item" code="'+a.code+'">'+a.name+"</a></li>"),d.append(i)}),d.find("a").click(function(e){e.preventDefault(),e.stopPropagation();var a=$(this),t=a.closest(".dropdown-menu"),i=t.find(".dropdown-menu");$.each(i,function(e,a){$(a).removeClass("show"),$(a).find("a").removeClass("active")}),t.find("> li > a").removeClass("active"),a.addClass("active");var r=[],n=[];a.parentsUntil(".cascader-list").each(function(e,a){var t;$(a).is("li")&&(t=$(a).find("> a"),r.push(t.text()),n.push(t.attr("code")))}),s.val(r.reverse().join("/")),s.attr("data-codes",JSON.stringify(n.reverse()));var l=a.parent(".dropup, .dropright, .dropdown, .dropleft");l.length?l.find(".dropdown-menu").addClass("show"):d.removeClass("show")});var r=s.attr("data-codes")?JSON.parse(s.attr("data-codes")):[],n=[],l=d;$.each(r,function(e,a){var t=l.find("> li:has(a[code='"+r[e]+"'])");if(t.length){var i=t.children("a");if(i.addClass("active"),n.push(i.text()),0===(l=t.children("ul")).length)return!1;l.addClass("show")}}),s.val(n.join("/"))}),t.find(".tag-cloud-input-group").each(function(e,a){function i(t){var e,i;0<(t=$.trim(t)).length&&(e=n.children(".badge"),i=!1,$.each(e,function(e,a){if($.trim($(a).text())==t)return!(i=!0)}),i?showWarning("已经包含该标签!"):n.find(".twitter-typeahead").before('<span class="font-size-base badge badge-soft-secondary mr-2">'+t+'<small class="fe fe-x ml-2" style="cursor:pointer" onclick="$(this).parent().remove();"></small></span>'))}var r,n=$(a),t=n.attr("data-tags")?JSON.parse(n.attr("data-tags")):[];n.find(".tag-input").typeahead({hint:!1,highlight:!0,minLength:0},{name:"tags",limit:10,source:(r=t,function(t,e){var i=[];$.each(r,function(e,a){a.includes(t)&&i.push(a)}),e(i)})}).bind("typeahead:select",function(e,a,t){i(a),$(this).typeahead("val","").blur()}).on("keyup",function(e){13==e.which&&(i($(this).val()),$(this).typeahead("val","").blur())})}),t.find("select.select2").each(function(e,a){var t=a.getAttribute("data-onchange"),i={containerCssClass:a.getAttribute("class").replace("select2",""),dropdownCssClass:a.classList.contains("custom-select-sm")||a.classList.contains("form-control-sm")?"dropdown-menu dropdown-menu-sm show":"dropdown-menu show",dropdownParent:a.closest(".modal-body")||document.body,tags:$(a).is("[tags]")};$(a).select2(i).on("select2:select",function(e){t&&window[t](e,a)})}),t.find(".plupload").each(function(e,a){install_plupload($(a))}),t.find(".quill").each(function(e,a){install_quill($(a))}),void t.find(".autosize").each(function(e,a){autosize(a)})))))})}var global_pluploading=!1;function install_plupload(e){var i=e.closest(".plupload-input-group").find(".plupload-input-result"),r=e.is("[multiple]"),o=e.data("hiddens"),a=e.data("upload"),t=e.data("token"),n=e.data("max"),c=e.attr("data-preview")?JSON.parse(e.attr("data-preview")):{},m=e.attr("data-suffix")?JSON.parse(e.attr("data-suffix")):{},l=e.attr("data-filters")?JSON.parse(e.attr("data-filters")):{},p=i.is(".image-input-result");e.attr("id","plupload-"+my_random());var s=new plupload.Uploader({browse_button:e[0],url:a,max_file_size:n,filters:l,multi_selection:r,multipart_params:{token:t}});s.init(),s.bind("FilesAdded",function(e,a){var t="";plupload.each(a,function(e){t+=p?'<div id="'+e.id+'" class="image uploading"><div class="progress progress-sm"><div class="progress-bar" style="width:5%;"></div></div></div>':'<div id="'+e.id+'" class="file uploading d-flex justify-content-start align-items-center"><div class="mr-3">'+e.name+'</div><div class="flex-grow-1 mr-3"><div class="progress progress-sm"><div class="progress-bar" style="width:5%;"></div></div></div></div>'}),r?i.append(t):i.html(t),e.start(),global_pluploading=!0}),s.bind("UploadProgress",function(e,a){$("#"+a.id).find(".progress-bar").css("width",a.percent+"%")}),s.bind("Error",function(e,a){var t;a.file&&$("#"+a.file.id).length?(t='<small class="text-danger">'+a.file.name+(p?"<br>":"")+a.message+" ("+a.code+")</small>",$("#"+a.file.id).removeClass("uploading").addClass("error").html(t)):showError("Failed when uploading, "+a.message+" ("+a.code+")")}),s.bind("FileUploaded",function(e,a,t){var i,r,n,l,s,d=jQuery.parseJSON(t.response);d.error?(i='<small class="text-danger">'+a.name+(p?"<br>":" ")+d.error+"</small>",$("#"+a.id).removeClass("uploading").addClass("error").html(i)):((r=$("#"+a.id)).removeClass("uploading").addClass("uploaded"),s=p?(n=my_preview(d.url,c),l=$("<img>").one("load",function(){$(this).closest(".image").css("width","auto")}).attr("src",n),r.html(l),'<div class="btns"><a href="'+d.url+'" target="_blank">i</a><a href="javascript:;" onclick="$(this).closest(\'.image\').remove();">x</a></div>'):(r.find(".flex-grow-1").remove(),'<div><a class="mr-2" href="'+d.url+'" target="_blank">i</a><a href="javascript:;" onclick="$(this).closest(\'.file\').remove();">x</a></div>'),r.append(s),$.each(o.split(","),function(e,a){var t=a in d?d[a]:"";"url"==a&&(t=my_preview(t,m));var i=$('<input type="hidden" name="'+a+'">').val(t);r.append(i)}))}),s.bind("UploadComplete",function(e,a){global_pluploading=!1})}function install_quill(e){var a=my_random(),t=e.data("upload"),i=e.data("token"),r=e.data("max"),n=e.attr("data-preview")?JSON.parse(e.attr("data-preview")):{},l=e.attr("data-filters")?JSON.parse(e.attr("data-filters")):{};e.attr("id","quill-"+a);var s=new Quill(e[0],{placeholder:"Please input rich text here",theme:"snow",modules:{toolbar:{container:[[{header:[2,!1]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],["link","image"],["blockquote","code-block"],["clean"]],handlers:{image:function(e){e?$("#quill-plupload-"+a).next(".moxie-shim").children("input[type=file]").trigger("click"):this.quill.format("image",!1)}}}}}),d=e.closest(".rte-input-group").find(".quill-plupload");d.attr("id","quill-plupload-"+a);var o=new plupload.Uploader({browse_button:d[0],url:t,max_file_size:r,filters:l,multi_selection:!0,multipart_params:{token:i}});o.init(),o.bind("FilesAdded",function(e,a){e.start(),global_pluploading=!0}),o.bind("Error",function(e,a){a.file?showError("Failed when uploading file "+a.file.name+", "+a.message+" ("+a.code+")"):showError("Failed when uploading, "+a.message+" ("+a.code+")")}),o.bind("FileUploaded",function(e,a,t){var i,r=jQuery.parseJSON(t.response);r.error?showError("Failed when uploading file "+a.name+", "+r.error):(i=(s.getSelection()||{}).index||s.getLength(),s.insertEmbed(i,"image",my_preview(r.url,n)),s.insertText(i+1,"\n"),s.setSelection(i+2))}),o.bind("UploadComplete",function(e,a){global_pluploading=!1})}function _process(l,e,s){var a,t,i,r,n,d,o,c,m,p,f,u,h,v,g,_,w,b,y,C,x,k,j,q,S,A,E,P,N,O,F,J,B,U,H;debug("Try to process path "+s),e.is(".object")?((a=e.children(".card")).length&&(e=a.children("div")),e.find("> .form-group, > .form-row .form-group, > .row  > div > .form-group, > .row  > div > .row  > div > .form-group, > .row  > div > .card > div > .row  > div > .form-group, > fieldset, > .row  > div > fieldset, > .row  > div > .card > div > fieldset, > .row  > div > .card > div > .row  > div > fieldset").each(function(e,a){var t=$(a).attr("name");t&&(t.includes(".")?_process(l,$(a),t):_process(l,$(a),s+"."+t))})):e.is(".array")?(t=e.find("> .cards"),i=e.find("> .modals, > .card > div > .modals"),r=e.find("> table, > .card > div > table"),n=e.find("> .list-group, > .card > div > .list-group"),d=e.find(".array-item"),o=e.find("select"),w=e.find(".plupload-input-group"),c=e.find(".tag-cloud-input-group, .relation-input-group"),m=e.find(".cascader-input-group"),t.length?t.find("> .card-wrapper, > .row > div > .card-wrapper, > div > .card-wrapper").not(".template").each(function(e,a){var t=$(a).find("> .card > .card-body > fieldset, > .card > fieldset");_process(l,t,s+"["+e+"]")}):i.length?i.find("> .modal").not(".template").each(function(e,a){var t=$(a).find(".modal-body > fieldset");_process(l,t,s+"["+e+"]")}):r.length?((p=r.find("> tbody > tr[name]").not(".template")).each(function(n,e){debug("Try to process table path "+s+"["+n+"]"),$(e).find("> td[name]").each(function(e,a){var t,i,r;$(a).is("[contenteditable=true]")?(debug("Try to process td path "+s+"["+n+"]."+$(a).attr("name")),$(a).removeClass("bg-danger-soft"),(t=$(a).text().trim()).length?(i=!0,"int"==(r=$(a).attr("format"))?i=/[0-9]/.test(t):"float"==r&&(i=/[0-9\.]/.test(t)),i?l[s+"["+n+"]."+$(a).attr("name")]=t:($(a).addClass("bg-danger-soft"),l.valid=!1)):$(a).is("[required]")&&($(a).addClass("bg-danger-soft"),l.valid=!1),debug("Parsed string is "+l[s+"["+n+"]."+$(a).attr("name")])):_process(l,$(a),s+"["+n+"]."+$(a).attr("name"))})}),debug("Parsed array's length is "+p.length)):n.length?n.find(".list-group-item[name]").not(".template").each(function(e,a){var t=$(a).find("> .row > .col:eq(0)").children();_process(l,t,s+"["+e+"]")}):d.length?d.not(".template").each(function(e,a){var t,i=$(a).find("fieldset[name]");i.length?_process(l,i,s+"["+e+"]"):(t=$(a).find(".form-group[name]")).length&&_process(l,t,s+"["+e+"]")}):o.length?(o.removeClass("is-valid is-invalid"),(f=o.val()).length?e.is(".relation")?(B=e.attr("relation-id"),U=e.attr("relation-title"),$.each(f,function(e,a){l[s+"["+e+"]."+B]=a,l[s+"["+e+"]."+U]=o.children("option[value="+a+"]").text()})):$.each(f,function(e,a){l[s+"["+e+"]"]=a}):o.is("[required]")&&(o.addClass("is-invalid"),l.valid=!1),debug("Parsed array's length is "+f.length)):w.length?(w.removeClass("is-valid is-invalid"),(u=w.find(".uploaded")).length?$.each(u,function(t,e){var a=$(e).find(":hidden[name]");1==a.length?l[s+"["+t+"]"]=a.val():$.each(a,function(e,a){l[s+"["+t+"]."+$(a).attr("name")]=$(a).val()})}):w.is("[required]")&&(w.addClass("is-invalid"),l.valid=!1),debug("Parsed array's length is "+u.length)):c.length?(c.removeClass("is-valid is-invalid"),(h=c.children(".badge")).length?e.is(".relation")?(B=c.parent(".form-group").attr("relation-id"),U=c.parent(".form-group").attr("relation-title"),$.each(h,function(e,a){l[s.replace("@","")+"["+e+"]."+B]=$(a).attr("data-id"),l[s.replace("@","")+"["+e+"]."+U]=$.trim($(a).text())})):$.each(h,function(e,a){l[s+"["+e+"]"]=$.trim($(a).text())}):c.is("[required]")&&(c.addClass("is-invalid"),l.valid=!1),debug("Parsed array's length is "+h.length)):m.length?(m.removeClass("is-valid is-invalid"),(g=(v=m.find(".cascader")).attr("data-codes")?JSON.parse(v.attr("data-codes")):[]).length?$.each(g,function(e,a){l[s+"["+e+"]"]=a}):m.is("[required]")&&(m.addClass("is-invalid"),l.valid=!1),debug("Parsed array's length is "+g.length)):e.children("fieldset").not(".template").each(function(e,a){_process(l,$(a),s+"["+e+"]")})):(_=e.find(".radio-input-group"),w=e.find(".plupload-input-group"),b=e.find(".rte-input-group"),y=e.find(".time-range-input-group"),C=e.find(".relation-input-group"),x=e.find(".input-group"),k=e.find("select"),j=e.find(":input[name]"),_.length?(_.removeClass("is-valid is-invalid"),(q=_.find(".active")).length?l[s]=q.children(":radio").val().trim():_.is("[required]")&&(_.addClass("is-invalid"),l.valid=!1)):w.length?(w.removeClass("in-valid is-invalid"),(S=w.find(".uploaded")).length?l[s]=S.find(":hidden[name=url]").val():w.is("[required]")&&(w.addClass("is-invalid"),l.valid=!1)):b.length?(b.removeClass("in-valid is-invalid"),A=b.find(".ql-editor").html().trim(),b.find(".ql-editor").text().trim().length?l[s]=A:b.is("[required]")&&(b.addClass("is-invalid"),l.valid=!1)):y.length?(P=(E=y.find("input.time-start")).val().trim(),O=(N=y.find("input.time-end")).val().trim(),y.removeClass("in-valid is-invalid"),E.removeClass("in-valid is-invalid"),N.removeClass("in-valid is-invalid"),P.length||O.length?(l[s.replace("@",E.attr("name"))]=P,l[s.replace("@",N.attr("name"))]=O,l[s]=P+"~"+O,!my_validateHhMm(P)||!my_validateHhMm(O)||O<=P?(y.addClass("is-invalid"),E.addClass("is-invalid"),N.addClass("is-invalid"),l.valid=!1):(y.addClass("is-valid"),E.addClass("is-valid"),N.addClass("is-valid"))):y.is("[required]")&&(y.addClass("is-invalid"),E.addClass("is-invalid"),N.addClass("is-invalid"),l.valid=!1)):C.length?(C.removeClass("is-valid is-invalid"),(F=C.children(".badge")).length?e.is(".relation")?(B=e.attr("relation-id"),U=e.attr("relation-title"),l[s.replace("@",B)]=F.attr("data-id"),l[s.replace("@",U)]=$.trim(F.text())):l[s]=$.trim(F.text()):C.is("[required]")&&(C.addClass("is-invalid"),l.valid=!1)):x.length?(J=x.find(":input[name]"),x.removeClass("is-invalid is-valid"),H=J.val().trim(),J.is(":checkbox")&&(H=J.is(":checked")?"true":"false"),H.length?(l[s]=H,J[0].checkValidity&&(!1===J[0].checkValidity()?(x.addClass("is-invalid"),J.addClass("is-invalid"),l.valid=!1):(x.addClass("is-valid"),J.addClass("is-valid")))):x.is("[required]")&&(x.addClass("is-invalid"),J.addClass("is-invalid"),l.valid=!1)):k.length?(k.removeClass("is-invalid is-valid"),(H=k.val()).length?e.is(".relation")?(B=e.attr("relation-id"),U=e.attr("relation-title"),l[s.replace("@",B)]=H,l[s.replace("@",U)]=k.children("option[value="+H+"]").text()):l[s]=H:k.is("[required]")&&(k.addClass("is-invalid"),l.valid=!1)):j.length&&(j.removeClass("is-invalid is-valid"),H=j.val().trim(),j.is(":checkbox")&&(H=j.is(":checked")?"true":"false"),H.length?(l[s]=H,j[0].checkValidity&&(!1===j[0].checkValidity()?(j.addClass("is-invalid"),l.valid=!1):j.addClass("is-valid"))):j.is("[required]")&&(j.addClass("is-invalid"),l.valid=!1)),debug("Parsed string is "+l[s]),s.includes("@")&&delete l[s])}function debug(e,a){console&&console.log&&(a?console.log(e,a):console.log(e))}function my_preview(e,a){var t=e.split(/[#?]/)[0],i=t.split(".").pop().trim().toLowerCase();return("mov"==i||"mp4"==i||"mpeg"==i||"webm"==i)&&"video"in a?t+a.video:"image"in a?t+a.image:e}function my_random(){return Math.floor(1e9*Math.random())}function my_validateHhMm(e){return/^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/.test(e)}
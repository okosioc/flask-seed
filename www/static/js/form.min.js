function install_form(){$(".form-editor").each(function(e,a){_install_form($(a))}),$(".form-query").each(function(e,a){_install_components($(a))})}function process_form(e){var a={valid:!0},t=e.find("> fieldset, > .card > div > fieldset");return _process(a,t,t.attr("name")),debug(a),a}function _install_form(e){_install_components(e)}function array_action_add(e){var a=e.closest("fieldset.array").find(".array-item.template"),t=a.clone(!0);t.removeClass("template"),t.insertBefore(a),a.next(".array-item").hide(),_install_components(t)}function array_action_delete(e){var a="确定删除此"+e.attr("data-title")+"么?";if(!window.confirm(a))return!1;var t=e.closest("fieldset.array").find(".array-item.template");1==t.prevAll(".array-item").length&&t.next(".array-item").show(),e.closest(".array-item").remove()}function array_action_show_modal(e){var a=e.closest(".array-item").prevAll(".array-item").length,t=e.closest("fieldset.array").find(".modals > .modal"),i=$(t.get(a));i.attr("id")||i.attr("id","modal-"+my_random()),i.modal("show")}function array_action_add_modal(e){var a=e.closest("fieldset.array").find(".modals > .modal.template"),t=a.clone(!0);t.removeClass("template").addClass("adding"),t.insertBefore(a),t.attr("id","modal-"+my_random()),_install_components(t),t.modal("show")}function array_action_cancel_modal(e){var a=e.closest(".modal");a.modal("hide"),a.is(".adding")&&a.remove()}function array_action_save_modal(e){var a=e.closest(".modal"),t={valid:!0},i=a.find(".modal-body > fieldset"),n=i.attr("name");if(_process(t,i,n),debug(t),!t.valid)return showError("检测到不正确的数据, 请更正后重试!"),!1;var r={};$.each(t,function(e,a){r[e.replace(n+".","")]=a}),debug(r);var l,s,d,o=e.closest("fieldset.array").find(".array-item[name]");a.is(".adding")?((s=(l=o.last()).clone(!0)).removeClass("template"),s.insertBefore(l),render_template_using_object(s,r),s.show(),l.next(".array-item").hide(),a.removeClass("adding")):(d=a.prevAll(".modal").length,render_template_using_object($(o.get(d)),r)),a.modal("hide")}function array_action_delete_modal(e){var a="确定删除此"+e.attr("data-title")+"么?";if(!window.confirm(a))return!1;var t=e.closest("fieldset.array").find(".array-item[name]");2==t.length&&t.last().next(".array-item").show();var i=e.closest(".array-item"),n=i.prevAll(".array-item").length,r=e.closest("fieldset.array").find(".modals > .modal");i.remove(),$(r.get(n)).remove()}var relation_action_search_records={};function relation_action_show_search_modal(e){$(".searching").removeClass("searching"),e.addClass("searching"),$("#search-"+e.attr("relation-key")).modal("show")}function relation_action_search(a,e){var t,i,n,r,l,s;a.is(".doing")||(i=(t=a.closest(".modal")).attr("relation-url"),n=t.attr("relation-key"),r={p:e},t.find(".form-search :input[name]").each(function(){r[$(this).attr("name")]=$(this).val()}),a.addClass("doing"),l=a.is("input")?"val":"text",s=a[l](),a[l](s+"..."),$.post(i,r,function(e){0==e.error?relation_action_render_results(n,e[n],e.pagination):showError(e.message),a.removeClass("doing"),a[l](s)},"json"))}function relation_action_render_results(i,e,t){var a=$("#search-"+i.replace(/_/g,"-")),i=a.attr("relation-key"),n=a.attr("relation-id"),r=a.find("table"),l=r.find("tbody > tr[name]").last();l.prevAll("tr").remove(),relation_action_search_records[i]=e,$.each(e,function(e,a){var t=l.clone(!0);t.removeClass("template"),t.insertBefore(l),render_template_using_object(t,a,i,n),t.show()}),e.length?l.next("tr").hide():l.next("tr").show();var t=t,s=r.next(".pagination");s.html(""),1<t.pages?(t.prev&&s.append('<li class="page-item"><a class="page-link" href="javascript:;" onclick="relation_action_search($(this), '+t.prev+')"><</a></li>'),$.each(t.iter_pages,function(e,a){a&&a==t.page?s.append('<li class="page-item active"><a class="page-link" href="javascript:;">'+a+'<span class="sr-only">(current)</span></a></li>'):a?s.append('<li class="page-item"><a class="page-link" href="javascript:;" onclick="relation_action_search($(this), '+a+')">'+a+"</a></li>"):s.append('<li class="page-item"><a class="page-link" href="javascript:;">...</a></li>')}),t.next&&s.append('<li class="page-item"><a class="page-link" href="javascript:;" onclick="relation_action_search($(this), '+t.next+')">></a></li>'),s.show()):s.hide()}function relation_action_search_reset(e){e.closest(".form-search").find(":input[name]").val("")}function relation_action_checkbox_changed(e){var a,t=e.closest("table").find("tbody > tr[name]").not(".template").find(".list-checkbox");e.is(".list-checkbox-all")?(a=e.is(":checked"),t.prop("checked",a)):a=e.is(":checked");var i=t.filter(":checked").length;e.closest(".modal-content").find(".modal-footer .span-checked").text(i)}function relation_action_choosed_return(e){var a=e.closest(".modal"),n=a.attr("relation-key"),t=a.attr("relation-title"),r=a.attr("relation-id"),i=e.closest(".modal-content").find(".modal-body table").find("tbody > tr[name]").not(".template").find(".list-checkbox:checked");if(0==i.length)return showError(e.attr("message")),!1;var l=$.map(i,function(e){return $(e).attr("id").replace(n+"-","")}),s=relation_action_search_records[n].filter(function(e){return l.includes(String(e[r]))}),d=$(".searching"),o=d.closest("fieldset.relation"),c=d.attr("relation-return");if("one"==c&&1<s.length)return showError("只能选择一个"+d.attr("data-title")+"!"),!1;var p,m,u,f=o.find(".form-group > .relation-input-group"),h=o.find(".array-item[name]");f.length?(p=f.children(".badge"),"one"==c&&p.remove(),$.each(s,function(e,a){f.append('<span class="font-size-base badge badge-soft-secondary mr-2" data-id="'+a[r]+'">'+a[t]+'<small class="fe fe-x ml-2" style="cursor:pointer" onclick="$(this).parent().remove();"></small></span>')})):h.length&&(m=h.last(),u=o.find(".modals > .modal").last(),$.each(s,function(e,a){var t=m.clone(!0);t.removeClass("template"),t.insertBefore(m),render_template_using_object(t,a,n,r),t.show(),m.next(".array-item").hide();var i=u.clone(!0);i.removeClass("template show"),i.insertBefore(u),render_template_using_object(i,a,n,r),i.attr("id","modal-"+my_random())})),e.closest(".search-modal").modal("hide")}function render_template_using_object(e,c,a,t){e.find("[name]").each(function(e,a){var s=$(a);if(s.is("fieldset")||s.is(".form-group"))return!0;var t,i=s.attr("name"),d=s.attr("format"),o=s.attr("enum"),n=c[i];function r(e){if(o)e=e&&global_enums[o][e];else if(["checkbox","switch"].includes(d))e="true"==e?"是":"否";else if("datetime"==d)e=e&&e.substr(0,19);else if(["text","int","float"].includes(d)){var a,t;if(0<(r=s.children()).length)return(r=r.clone(!0)).is(".avatar")?(a=r.find(".avatar-title"),e?a.text(e[0]):a.text("")):r.is(".progress")?(t=r.find(".progress-bar"),e?t.css("width",e+"%").attr("aria-valuenow",e):t.css("width","0%").attr("aria-valuenow","0")):r.text("UNSUPPORTED!"),r}else{if(["avatar","image"].includes(d)){var i=(r=s.children().clone(!0)).find("img"),n=i.next("span[fallback]");return e?(i.removeClass("d-none").attr("src",e),n.addClass("d-none").text("")):(i.addClass("d-none").attr("src",""),n.removeClass("d-none").text(c[n.attr("fallback")][0])),r}if("link"==d){var r,l=(r=s.children().clone(!0)).find("a");return e?l.attr("href",e):l.attr("href","javascript:;"),r}}return e||"-"}Array.isArray(n)?n.length?"object"==typeof n[0]&&null!==n[0]?s.html(n.length):s.html(n.map(r).join(" ")):s.html("-"):"object"==typeof n&&null!==n?(t=null,$.each(n,function(e,a){if(a.match(/title|name|\w+name/i))return t=a,!1}),t?(n=n[t],s.html(n||"-")):s.html("-")):s.is(":input")?s.val(r(n)):s.html(r(n))});var i=e.find(".list-checkbox");t&&i.length&&(i.attr("id",a+"-"+c[t]),i.next("label").attr("for",a+"-"+c[t]))}function relation_action_search_reset(e){e.closest(".form-search").find(":input[name]").val("")}function external_link_open(e){var a=e.closest(".input-group").find("input[name]").val().trim();a.length&&(a.startsWith("http://")||a.startsWith("https://")?window.open(a):showWarning("Please input a valid link!"))}function _install_components(e){e.find(".form-group").each(function(e,a){var t=$(a);return!t.closest(".array-item").is(".template")&&(!t.closest(".modal").is(".template")&&(t.find("img[data-src]").each(function(e,a){var t,i=$(a).closest(".plupload-input-group").children(".plupload");i&&(t=i.attr("data-preview")?JSON.parse(i.attr("data-preview")):{},$(a).attr("src",my_preview($(a).data("src"),t)))}),t.find(".custom-switch").each(function(e,a){var t="switch-"+my_random(),i=$(a).find(":checkbox");i.attr("id",t),i.next("label").attr("for",t)}),t.find("input.date-time").each(function(e,a){$(a).flatpickr({locale:"zh",allowInput:!0,enableTime:!0,dateFormat:"Y-m-d H:i:S",defaultHour:(new Date).getHours(),defaultMinute:(new Date).getMinutes()})}),t.find("input.date").each(function(e,a){$(a).flatpickr({allowInput:!0,locale:"zh",dateFormat:"Y-m-d"})}),t.find(".time-range-input-group").each(function(e,a){var t=$(a).find(".time-start").timepicker({timeFormat:"H:i"}),i=$(a).find(".time-end").timepicker({timeFormat:"H:i"});t.change(function(){var e=$(this).val();if(!my_validateHhMm(e))return!1;var a=e.split(":"),t=(parseInt(a[0])+1).toString().padStart(2,"0");i.val(t+":"+a[1])})}),t.find(".cascader-input-group").each(function(e,a){var s=$(a).find(".cascader"),d=$(a).find(".cascader-list"),t=(t=window[s.attr("data-source")])||[];$.each(t,function(e,a){var t,i=null;a.children&&a.children.length?(i=$('<li class="dropright"><a class="dropdown-item dropdown-toggle" href="javascript:;" data-toggle="dropdown" code="'+a.code+'">'+a.name+"</a></li>"),t=$('<ul class="dropdown-menu"></ul>'),$.each(a.children,function(e,a){t.append($('<li><a class="dropdown-item" href="javascript:;" code="'+a.code+'">'+a.name+"</a></li>"))}),i.append(t)):i=$('<li><a class="dropdown-item" code="'+a.code+'">'+a.name+"</a></li>"),d.append(i)}),d.find("a").click(function(e){e.preventDefault(),e.stopPropagation();var a=$(this),t=a.closest(".dropdown-menu"),i=t.find(".dropdown-menu");$.each(i,function(e,a){$(a).removeClass("show"),$(a).find("a").removeClass("active")}),t.find("> li > a").removeClass("active"),a.addClass("active");var n=[],r=[];a.parentsUntil(".cascader-list").each(function(e,a){var t;$(a).is("li")&&(t=$(a).find("> a"),n.push(t.text()),r.push(t.attr("code")))}),s.val(n.reverse().join("/")),s.attr("data-codes",JSON.stringify(r.reverse()));var l=a.parent(".dropup, .dropright, .dropdown, .dropleft");l.length?l.find(".dropdown-menu").addClass("show"):d.removeClass("show")});var n=s.attr("data-codes")?JSON.parse(s.attr("data-codes")):[],r=[],l=d;$.each(n,function(e,a){var t=l.find("> li:has(a[code='"+n[e]+"'])");if(t.length){var i=t.children("a");if(i.addClass("active"),r.push(i.text()),0===(l=t.children("ul")).length)return!1;l.addClass("show")}}),s.val(r.join("/"))}),t.find(".tag-cloud-input-group").each(function(e,a){function i(t){var e,i;0<(t=$.trim(t)).length&&(e=r.children(".badge"),i=!1,$.each(e,function(e,a){if($.trim($(a).text())==t)return!(i=!0)}),i?showWarning("已经包含该标签!"):r.find(".twitter-typeahead").before('<span class="font-size-base badge badge-soft-secondary mr-2 mb-2">'+t+'<small class="fe fe-x ml-2" style="cursor:pointer" onclick="$(this).parent().remove();"></small></span>'))}var n,r=$(a),t=r.attr("data-tags")?JSON.parse(r.attr("data-tags")):[];r.find(".tag-input").typeahead({hint:!1,highlight:!0,minLength:0},{name:"tags",limit:10,source:(n=t,function(t,e){var i=[];$.each(n,function(e,a){a.includes(t)&&i.push(a)}),e(i)})}).bind("typeahead:select",function(e,a,t){i(a),$(this).typeahead("val","").blur()}).on("keyup",function(e){13==e.which&&(i($(this).val()),$(this).typeahead("val","").blur())})}),t.find(".range-input-group").each(function(e,a){var t=$(a).find(".custom-range"),i=$(a).find(".range-value"),n=i.text(),r=$(a).attr("data-steps")?JSON.parse($(a).attr("data-steps")):{},l=-1;if(Object.keys(r).length)for(var s in l=Object.keys(r).length-1,t.attr("max",l),r)if(String(r[s])==n){t.val(parseInt(s));break}t.on("input",function(){var e=String($(this).val()),a=e;-1!=l&&(a=r[e]),i.text(a)})}),t.find("select.select2").each(function(e,a){var t=a.getAttribute("data-onchange"),i={containerCssClass:a.getAttribute("class").replace("select2",""),dropdownCssClass:a.classList.contains("custom-select-sm")||a.classList.contains("form-control-sm")?"dropdown-menu dropdown-menu-sm show":"dropdown-menu show",dropdownParent:a.closest(".modal-body")||document.body,tags:$(a).is("[tags]")};$(a).select2(i).on("select2:select",function(e){t&&window[t](e,a)})}),t.find(".plupload").each(function(e,a){install_plupload($(a))}),t.find(".quill").each(function(e,a){install_quill($(a))}),void t.find(".autosize").each(function(e,a){autosize(a)})))})}var global_pluploading=!1;function install_plupload(e){var i=e.closest(".plupload-input-group").find(".plupload-input-result"),n=e.is("[multiple]"),o=e.data("hiddens"),a=e.data("upload"),t=e.data("token"),r=e.data("max"),c=e.attr("data-preview")?JSON.parse(e.attr("data-preview")):{},p=e.attr("data-suffix")?JSON.parse(e.attr("data-suffix")):{},l=e.attr("data-filters")?JSON.parse(e.attr("data-filters")):{},m=i.is(".image-input-result");e.attr("id","plupload-"+my_random());var s=new plupload.Uploader({browse_button:e[0],url:a,max_file_size:r,filters:l,multi_selection:n,multipart_params:{token:t}});s.init(),s.bind("FilesAdded",function(e,a){var t="";plupload.each(a,function(e){t+=m?'<div id="'+e.id+'" class="image uploading"><div class="progress progress-sm"><div class="progress-bar" style="width:5%;"></div></div></div>':'<div id="'+e.id+'" class="file uploading d-flex justify-content-start align-items-center"><div class="mr-3">'+e.name+'</div><div class="flex-grow-1 mr-3"><div class="progress progress-sm"><div class="progress-bar" style="width:5%;"></div></div></div></div>'}),n?i.append(t):i.html(t),e.start(),global_pluploading=!0}),s.bind("UploadProgress",function(e,a){$("#"+a.id).find(".progress-bar").css("width",a.percent+"%")}),s.bind("Error",function(e,a){var t;a.file&&$("#"+a.file.id).length?(t='<small class="text-danger">'+a.file.name+(m?"<br>":"")+a.message+" ("+a.code+")</small>",$("#"+a.file.id).removeClass("uploading").addClass("error").html(t)):showError("Failed when uploading, "+a.message+" ("+a.code+")")}),s.bind("FileUploaded",function(e,a,t){var i,n,r,l,s,d=jQuery.parseJSON(t.response);d.error?(i='<small class="text-danger">'+a.name+(m?"<br>":" ")+d.error+"</small>",$("#"+a.id).removeClass("uploading").addClass("error").html(i)):((n=$("#"+a.id)).removeClass("uploading").addClass("uploaded"),s=m?(r=my_preview(d.url,c),l=$("<img>").one("load",function(){$(this).closest(".image").css("width","auto")}).attr("src",r),n.html(l),'<div class="btns"><a href="'+d.url+'" target="_blank">i</a><a href="javascript:;" onclick="$(this).closest(\'.image\').remove();">x</a></div>'):(n.find(".flex-grow-1").remove(),'<div><a class="mr-2" href="'+d.url+'" target="_blank">i</a><a href="javascript:;" onclick="$(this).closest(\'.file\').remove();">x</a></div>'),n.append(s),$.each(o.split(","),function(e,a){var t=a in d?d[a]:"";"url"==a&&(t=my_preview(t,p));var i=$('<input type="hidden" name="'+a+'">').val(t);n.append(i)}))}),s.bind("UploadComplete",function(e,a){global_pluploading=!1})}function install_quill(e){var a=my_random(),t=e.data("upload"),i=e.data("token"),n=e.data("max"),r=e.attr("data-preview")?JSON.parse(e.attr("data-preview")):{},l=e.attr("data-filters")?JSON.parse(e.attr("data-filters")):{};e.attr("id","quill-"+a);var s=new Quill(e[0],{placeholder:"Please input rich text here",theme:"snow",modules:{toolbar:{container:[[{header:[2,!1]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],["link","image"],["blockquote","code-block"],["clean"]],handlers:{image:function(e){e?$("#quill-plupload-"+a).next(".moxie-shim").children("input[type=file]").trigger("click"):this.quill.format("image",!1)}}}}}),d=e.closest(".rte-input-group").find(".quill-plupload");d.attr("id","quill-plupload-"+a);var o=new plupload.Uploader({browse_button:d[0],url:t,max_file_size:n,filters:l,multi_selection:!0,multipart_params:{token:i}});o.init(),o.bind("FilesAdded",function(e,a){e.start(),global_pluploading=!0}),o.bind("Error",function(e,a){a.file?showError("Failed when uploading file "+a.file.name+", "+a.message+" ("+a.code+")"):showError("Failed when uploading, "+a.message+" ("+a.code+")")}),o.bind("FileUploaded",function(e,a,t){var i,n=jQuery.parseJSON(t.response);n.error?showError("Failed when uploading file "+a.name+", "+n.error):(i=(s.getSelection()||{}).index||s.getLength(),s.insertEmbed(i,"image",my_preview(n.url,r)),s.insertText(i+1,"\n"),s.setSelection(i+2))}),o.bind("UploadComplete",function(e,a){global_pluploading=!1})}function _process(n,e,r){var a,t,i,l,s,d,o,c,p,m,u,f,h,v,g,_,w,b,y,C,x,k,j,q,S,O,N,J,E,F,P,A,U,H;debug("Try to process path "+r+" with "+e.attr("class")),e.is(".object")||e.is(".group")?((a=e.children(".card")).length&&(e=a.children("div")),e.find("> .form-group, > .form-row .form-group, > .row  > div > .form-group, > .row  > div > .row  > div > .form-group, > .row  > div > .card > div > .row  > div > .form-group, > fieldset, > .row  > div > fieldset, > .row  > div > .card > div > fieldset, > .row  > div > .card > div > .row  > div > fieldset").each(function(e,a){var t;$(a).is("fieldset.group")?_process(n,$(a),r):(t=$(a).attr("name"))&&(t.includes(".")?_process(n,$(a),t):_process(n,$(a),r+"."+t))})):e.is(".array")?(t=e.find(".modals"),i=e.find(".array-item[name]"),l=e.find("select"),h=e.find(".plupload-input-group"),s=e.find(".tag-cloud-input-group, .relation-input-group"),d=e.find(".cascader-input-group"),t.length?t.find("> .modal").not(".template").each(function(e,a){var t=$(a).find(".modal-body > fieldset");_process(n,t,r+"["+e+"]")}):i.length?i.not(".template").each(function(t,e){var a,i;$(e).is("tr")?$(e).find("> td[name]").each(function(e,a){_process(n,$(a),r+"["+t+"]."+$(a).attr("name"))}):(a=$(e).find("fieldset[name]")).length?_process(n,a,r+"["+t+"]"):(i=$(e).find(".form-group[name]")).length&&_process(n,i,r+"["+t+"]")}):l.length?(l.removeClass("is-valid is-invalid"),(o=l.val()).length?e.is(".relation")?(A=e.children(".form-group").attr("relation-id"),U=e.children(".form-group").attr("relation-title"),$.each(o,function(e,a){n[r+"["+e+"]."+A]=a,n[r+"["+e+"]."+U]=l.children("option[value="+a+"]").text()})):$.each(o,function(e,a){n[r+"["+e+"]"]=a}):l.is("[required]")&&(l.addClass("is-invalid"),n.valid=!1),debug("Parsed array's length is "+o.length)):h.length?(h.removeClass("is-valid is-invalid"),(c=h.find(".uploaded")).length?$.each(c,function(t,e){var a=$(e).find(":hidden[name]");1==a.length?n[r+"["+t+"]"]=a.val():$.each(a,function(e,a){n[r+"["+t+"]."+$(a).attr("name")]=$(a).val()})}):h.is("[required]")&&(h.addClass("is-invalid"),n.valid=!1),debug("Parsed array's length is "+c.length)):s.length?(s.removeClass("is-valid is-invalid"),(p=s.children(".badge")).length?e.is(".relation")?(A=s.parent(".form-group").attr("relation-id"),U=s.parent(".form-group").attr("relation-title"),$.each(p,function(e,a){n[r.replace("@","")+"["+e+"]."+A]=$(a).attr("data-id"),n[r.replace("@","")+"["+e+"]."+U]=$.trim($(a).text())})):$.each(p,function(e,a){n[r+"["+e+"]"]=$.trim($(a).text())}):s.is("[required]")&&(s.addClass("is-invalid"),n.valid=!1),debug("Parsed array's length is "+p.length)):d.length?(d.removeClass("is-valid is-invalid"),(u=(m=d.find(".cascader")).attr("data-codes")?JSON.parse(m.attr("data-codes")):[]).length?$.each(u,function(e,a){n[r+"["+e+"]"]=a}):d.is("[required]")&&(d.addClass("is-invalid"),n.valid=!1),debug("Parsed array's length is "+u.length)):e.children("fieldset").not(".template").each(function(e,a){_process(n,$(a),r+"["+e+"]")})):(f=e.find(".radio-input-group"),h=e.find(".plupload-input-group"),v=e.find(".rte-input-group"),g=e.find(".time-range-input-group"),_=e.find(".range-input-group"),w=e.find(".relation-input-group"),b=e.find(".input-group"),y=e.find("div[contenteditable]"),C=e.find("select"),x=e.find(":input[name]"),f.length?(f.removeClass("is-valid is-invalid"),(k=f.find(".active")).length?n[r]=k.children(":radio").val().trim():f.is("[required]")&&(f.addClass("is-invalid"),n.valid=!1)):h.length?(h.removeClass("in-valid is-invalid"),(j=h.find(".uploaded")).length?n[r]=j.find(":hidden[name=url]").val():h.is("[required]")&&(h.addClass("is-invalid"),n.valid=!1)):v.length?(v.removeClass("in-valid is-invalid"),q=v.find(".ql-editor").html().trim(),v.find(".ql-editor").text().trim().length?n[r]=q:v.is("[required]")&&(v.addClass("is-invalid"),n.valid=!1)):g.length?(O=(S=g.find("input.time-start")).val().trim(),J=(N=g.find("input.time-end")).val().trim(),g.removeClass("in-valid is-invalid"),S.removeClass("in-valid is-invalid"),N.removeClass("in-valid is-invalid"),O.length||J.length?(n[r.replace("@",S.attr("name"))]=O,n[r.replace("@",N.attr("name"))]=J,n[r]=O+"~"+J,!my_validateHhMm(O)||!my_validateHhMm(J)||J<=O?(g.addClass("is-invalid"),S.addClass("is-invalid"),N.addClass("is-invalid"),n.valid=!1):(g.addClass("is-valid"),S.addClass("is-valid"),N.addClass("is-valid"))):g.is("[required]")&&(g.addClass("is-invalid"),S.addClass("is-invalid"),N.addClass("is-invalid"),n.valid=!1)):_.length?(_.removeClass("in-valid is-invalid"),(E=_.find(".range-value").text().trim()).length?n[r]=E:_.is("[required]")&&(_.addClass("is-invalid"),n.valid=!1)):w.length?(w.removeClass("is-valid is-invalid"),(F=w.children(".badge")).length?e.is(".relation")?(A=e.attr("relation-id"),U=e.attr("relation-title"),n[r.replace("@",A)]=F.attr("data-id"),n[r.replace("@",U)]=$.trim(F.text())):n[r]=$.trim(F.text()):w.is("[required]")&&(w.addClass("is-invalid"),n.valid=!1)):b.length?(P=b.find(":input[name]"),b.removeClass("is-invalid is-valid"),H=P.val().trim(),P.is(":checkbox")&&(H=P.is(":checked")?"true":"false"),H.length?(n[r]=H,P[0].checkValidity&&(!1===P[0].checkValidity()?(b.addClass("is-invalid"),P.addClass("is-invalid"),n.valid=!1):(b.addClass("is-valid"),P.addClass("is-valid")))):b.is("[required]")&&(b.addClass("is-invalid"),P.addClass("is-invalid"),n.valid=!1)):y.length?(y.removeClass("is-invalid is-valid"),H=y.html(),y.text().trim().length?n[r]=H:y.is("[required]")&&(y.addClass("is-invalid"),n.valid=!1)):C.length?(C.removeClass("is-invalid is-valid"),(H=C.val()).length?e.is(".relation")?(A=e.attr("relation-id"),U=e.attr("relation-title"),n[r.replace("@",A)]=H,n[r.replace("@",U)]=C.children("option[value="+H+"]").text()):n[r]=H:C.is("[required]")&&(C.addClass("is-invalid"),n.valid=!1)):x.length&&(x.removeClass("is-invalid is-valid"),H=x.val().trim(),x.is(":checkbox")&&(H=x.is(":checked")?"true":"false"),H.length?(n[r]=H,x[0].checkValidity&&(!1===x[0].checkValidity()?(x.addClass("is-invalid"),n.valid=!1):x.addClass("is-valid"))):x.is("[required]")&&(x.addClass("is-invalid"),n.valid=!1)),debug("Parsed string is "+n[r]),r.includes("@")&&delete n[r])}function debug(e,a){console&&console.log&&(a?console.log(e,a):console.log(e))}function my_preview(e,a){var t=e.split(/[#?]/)[0],i=t.split(".").pop().trim().toLowerCase();return("mov"==i||"mp4"==i||"mpeg"==i||"webm"==i)&&"video"in a?t+a.video:"image"in a?t+a.image:e}function my_random(){return Math.floor(1e9*Math.random())}function my_validateHhMm(e){return/^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/.test(e)}
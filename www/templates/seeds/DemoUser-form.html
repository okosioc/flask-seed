<div id="div-demo-user-form">
    <form id="demo-user-form" class="form-editor needs-validation" novalidate method="post">
        <div class="card"><div class="card-header"><h4 class="card-header-title"><i class="fe fe-user mr-2"></i>用户</h4></div><div class="card-body">
        <fieldset class="object" name="demo_user" format="">
            <div class="row">
                <div class="col-sm">
                    <div class="form-group " name="name">
                        <label class=""><span class="text-danger mr-1">*</span>用户名</label>
                        <input name="name" type="text" class="form-control" required
                               value="{{ demo_user.name or '' }}">
                        <div class="invalid-feedback">请输入正确的用户名!</div>
                    </div>
                    <!-- /.text -->
                    <!-- /.string -->
                </div>
            </div>
            <div class="row">
                <div class="col-sm">
                    <div class="form-group " name="phone">
                        <label class="">手机号</label>
                        <input name="phone" type="text" class="form-control" 
                               value="{{ demo_user.phone or '' }}">
                        <div class="invalid-feedback">请输入正确的手机号!</div>
                    </div>
                    <!-- /.text -->
                    <!-- /.string -->
                </div>
            </div>
            <div class="row">
                <div class="col-sm">
                    <div class="form-group " name="intro">
                        <label class="">个人简介</label>
                        <textarea name="intro" rows="5"
                                  class="form-control autosize" >{{ demo_user.intro or '' }}</textarea>
                        <div class="invalid-feedback">请输入正确的个人简介!</div>
                    </div>
                    <!-- /.textarea -->
                    <!-- /.string -->
                </div>
            </div>
            <div class="row">
                <div class="col-sm">
                    <div class="form-group string " name="avatar">
                        <label class="">头像</label>
                        <div class="plupload-input-group image-input-group" >
                            <a class="btn btn-outline-primary plupload" href="javascript:;"
                               data-token="{{ upload_config.token }}"
                               data-upload="{{ upload_config.endpoint }}"
                               data-max="{{ upload_config.max }}"
                               data-preview='{"image":"?imageView2/1/w/200/h/200/","video":""}'
                               data-suffix='{"image":"?imageView2/1/w/200/h/200/","video":""}'
                               data-filters='{"mime_types":"{{ upload_config.mimes_image|join(", ") }}"}'
                               data-hiddens="url">选择图片...</a>
                            <small class="mt-2 form-text text-muted">支持的图片格式有 {{ upload_config.mimes_image|join(', ') }}</small>
                            <div class="plupload-input-result image-input-result mt-1 clearfix">
                                {% if demo_user.avatar %}
                                <div class="image uploaded" style="width: auto">
                                    <img data-src="{{ demo_user.avatar }}">
                                    <div class="btns">
                                        <a href="{{ demo_user.avatar }}" target="_blank">i</a>
                                        <a href="javascript:;" onclick="$(this).closest('.image').remove();">x</a>
                                    </div>
                                    <input type="hidden" name="url" value="{{ demo_user.avatar }}">
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="invalid-feedback">请上传头像!</div>
                    </div>
                    <!-- /.avatar -->
                    <!-- /.string -->
                </div>
            </div>
            <!-- /.layout -->
        </fieldset>
        </div></div>
        <!-- /.object -->
    </form>
    <div class="form-actions mb-4">
        <a class="btn btn-primary mr-2" onclick="post_demo_user_form($(this));"><i class="fe fe-save mr-1"></i>保存</a>
        {% if demo_user.id %}
        <a href="javascript:;" class="btn btn-outline-primary mr-2"><i class="fe fe-corner-up-left mr-1"></i>返回</a>
        {% endif %}
    </div>
</div>
<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function(){
        // init
    });
    function post_demo_user_form(btn){
        if (btn.is(".doing")) {
            return;
        }
        var msg = "确定要保存么?";
        var con = window.confirm(msg);
        if (!con) {
            return false;
        }
        var param = process_form($("#demo-user-form"));
        if (!param["valid"]) {
            showError('检测到不正确的数据, 请更正后重试!');
            return false;
        }
        //
        btn.addClass("doing");
        var method = btn.is("input") ? "val" : "text";
        var oldLabel = btn[method]();
        btn[method](oldLabel + "...");
        //
        {% for arg in args %}
        param["demo_user.{{ arg[0] }}"] = "{{ arg[1] }}";
        {% endfor %}
        //
        var url = "{{ request.path }}/demo-user-form?id={{ demo_user.id or '' }}";
        $.post(url, param, function (result) {
            if (result.error == 0) {
                showSuccess(result.message);
                showInfo('Refreshing...');
                setTimeout(function () {
                    location.href = "{{ request.path }}?id=" + result.id;
                }, 2000);
            } else {
                showError(result.message);
            }
            btn.removeClass("doing");
            btn[method](oldLabel);
        }, "json");
    }
</script>
